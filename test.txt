■ 테스트 케이스 관련 링크
https://chromium.googlesource.com/chromium/src.git/+/62.0.3178.1/third_party/WebKit/LayoutTests/external/wpt/css/css-ui-3
https://github.com/servo/servo/tree/master/tests/wpt/css-tests/css-color-3_dev/html4/support

■ WICG에 올릴 내용
웹에서 퀄리티 높은 Spatial Navigation을 제공한다면, 이는 웹의 큰 장점이 될 수 있다. (유스케이스 좌좌좍)
안드로이드, 윈도우 등 다양한 플랫폼에서 포커스 네비게이션 기능 제공 중, 대부분 tab을 쓴다.
보통 input 요소나 하이퍼링크 등에 활용하고 이는 현재 브라우저에서 제공 중인 것과 유사하다.

Spatial Navigation이 필요한 도메인이 TV 외에 또 있을지?(A11y, IVI) 어떤 유스케이스가 있을지?
-> VR (3D), 장애인 지원 / TV UI 지원 / IVI 지원 

CSSUI4에 있는 nav-* 프로퍼티들이 크로미움이 아닌 다른 브라우저에서도 관심을 갖게 하려면 어떻게 해야 할지?
-> Firefox 기반 모바일/TV, VR, HbbTV/ATSC

크로미움에서만 구현이 진행되어도 nav-* 프로퍼티들이 표준으로 승인 받을 수 있을지?

Heuristic spatial navigation을 어느 수준으로 작업해서 공개하고 어떤 활동들을 진행할 수 있을지?
-> input시 스크롤, 포커스, no action (동작 원리 명시)
-> OffScreen 상황에서 어떻게 동작이 되어야 하나 (흔하게 발생 가능한 상황)

Heuristic algorithm과 CSS 프로퍼티 사이의 관계를 어떻게 정립해야 할지?
-> 프로퍼티 value로 축 기준 이런 명시 가능?

focus moving은 CSS에서만 지원해야 할지, HTML에서만 지원해야 할지, 둘 다에서 지원해야 할지?
-> visual order를 고려할 수 있는 CSS에서의 focus moving 설정이 필요하므로, 둘 다 지원해야 함

키보드 유저를 위해 tab order가 아닌 nav order를 위한 nav-tree를 구성하는 것이 가능할지? (HOW?)
: https://logs.csswg.org/irc.w3.org/css/2015-02-25/#e528223

nav-order 쓰임새 검토
: https://github.com/w3c/csswg-drafts/issues/1748
: https://github.com/w3c/csswg-drafts/issues/1764 


■ 스크롤 큰 그림
onscroll, onfocus는 결과(by trigger), onkey/mouse/touch 는 원인(trigger)
onscroll 이벤트 핸들러에서 세부 항목 정할 수 있을까? 이 스크롤이 왜 발생했는지에 따라 불릴수도 안불릴수도
onscroll 이벤트 핸들러의 event 객체 안에 유발 요인을 명시할 수 있다면!! onscroll 부하를 줄이는 방법 없을까?
preventScroll() 함수가 의미가 있을지??
onkey/mouse/touch에서는 preventDefault() 함수로 캔슬 가능
onscroll, onfocus, focus(), offscreen input box에 입력, 탭 키 입력 등의 상황에서는 스크롤 캔슬 불가능
onbeforescroll 보다는 onuserscroll, onsystemscroll 구분하기?


■ 9월 13일(수) 아젠다
spotlight 시나리오 지원을 위해 필요한 CSS 프로퍼티는 무엇인지?
휴리스틱을 오버라이드 하기 위한 효과적인 방법은?
(nav-up/right/down/left v.s nav-order)
신규 API 안 검토 (nextFocus 함수 포함, 이벤트? DOM 속성?)
스크롤 에어리어나 iframe에 포커스 주는 방법? section 개념 검토
https://github.com/whatwg/html/issues/2851
백 책임님에게 focus()로 인한 스크롤 발생시 이를 cancel시키는 trick을 어떻게 구현했는지 물어보기

스크롤러블 에어리어가 두 개 있고, 그 안에 요소가 offscreen인 경우?? 애니메이션이 두개??
휴리스틱으로 특정 노드 주변을 찾을 때, findNextfocusableNode() 신규 함수 활용 안 검토 (서준호 선임 메일)
아니면 focusin 이벤트 활용이 가능할지?
포커스 체이닝 정보 사전 컴파일을 위해 AOM 활용 가능한지?


HbbTV 관련해서 WICG에 올릴 때 과거 이런 히스토리가 있었다. 도와줘라.
https://www.hbbtv.org/wp-content/uploads/2015/07/HbbTV_specification_2_0.pdf (103-104)

Applications shall not rely on receiving any key events not requested through a Keyset object, for example when the end user is inputting text into an input field. However, the set of key events requested via a Keyset object only identifies the minimum set of keys that may be sent to an application, and so applications should not rely on receiving only those key events.

On up, down, left, right keydown events, terminals shall choose one of the following navigation mechanisms in the priority order listed below:
- Allow applications to capture the events and prevent the default action (known as "JavaScript navigation").
- Handle CSS3 directional focus navigation when the nav-up, nav-right, nav-down and nav-left CSS properties are used by the application.
- A default navigation mechanism provided by the terminal which shall allow focus to be moved between navigable elements and allow all navigable elements to gain focus.

NOTE: Applications shall set the NAVIGATION bit of the keyset object even if the navigation keys are only used for focus based navigation (including the CSS nav-* properties) and not used in JavaScript event handlers.





1. heuristic spatial navigation algorithm 분석 및 개선안 도출 (upstream 반영 목표, 서준호 선임 담당)
2. CSSUI4 nav-* properties 표준화 추진 및 이슈 논의 주도 (upstream 적용 목표, 홍지혜 선임 담당)
3. spotlight와 위의 1/2번 기능간의 연계 검토 및 추가로 필요한 표준 API 도출 (DOM attribute/event, CSS property, 백승천 책임 담당)


Heuristic spatial navigation 및 CSSUI4 nav-* 프로퍼티 구현의 자사 참여를 통해 얻을 수 있는 것
http://kizu.ru/en/blog/keyboard-only-focus/

https://bugs.webkit.org/buglist.cgi?bug_status=UNCONFIRMED&bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&bug_status=RESOLVED&bug_status=VERIFIED&bug_status=CLOSED&component=Accessibility&component=ANGLE&component=Animations&component=Bindings&component=bmalloc&component=Canvas&component=CSS&component=Evangelism&component=Event%20Handling&component=Forms&component=Frames&component=History&component=HTML%20DOM&component=HTML%20Editing&component=HTML%20Events&component=Images&component=Java&component=JavaScriptCore&component=Layout%20and%20Rendering&component=MathML&component=Media%20Elements&component=New%20Bugs&component=Page%20Loading&component=PDF&component=Perf%20Dashboard&component=Platform&component=Plug-ins&component=Printing&component=Security&component=SVG&component=Tables&component=Text&component=Tools%20%2F%20Tests&component=Web%20Audio&component=Web%20Inspector&component=Web%20Inspector%20%28Deprecated%29&component=Web%20Template%20Framework&component=WebCore%20JavaScript&component=WebCore%20Misc.&component=WebGL&component=WebKit%20API&component=WebKit%20BlackBerry&component=WebKit%20BREWMP&component=WebKit%20EFL&component=WebKit%20Gtk&component=WebKit%20Misc.&component=WebKit%20Qt&component=WebKit%20Website&component=WebKit%20WPE&component=WebKit%20wx&component=WebKit2&component=XML&component=XML%20DOM&order=bug_id&product=Closed%20Components&product=Security&product=WebKit&query_format=advanced&resolution=---&resolution=FIXED&resolution=INVALID&resolution=WONTFIX&resolution=LATER&resolution=REMIND&resolution=DUPLICATE&resolution=WORKSFORME&resolution=MOVED&resolution=CONFIGURATION%20CHANGED&short_desc=spatial%20navigation&short_desc_type=substring

https://bugs.chromium.org/p/chromium/issues/list?can=1&q=spatial%20navigation

https://trac.webkit.org/changeset/55543/webkit




크게 3가지 방향성, 3번은 meta 태그 대신 엘리먼트에서 css 속성으로 default behavior 선택할 수 있게 해보기



샘플 앱 및 분석 결과를 통해 느낀점
- reachability는 보장되지 않는 것이 맞는 것 같다. (물론 가급적 발생하지 않는 고려는 해야겠지만, 절대적인 보장은 불가능)
- author가 spatial navigation mode를 제어할 수 있는 옵션 CSS rule, 
- CSSUI nav-* 프로퍼티의 upstream 반영 시도시 지적 받은 엉망이라는 부분이 이 부분인 것 같음
- Blink에서는 요소를 대표하는 점을 꼭지점으로 정의
- Spotlight에서는 top/bottom(y축), left/right(x축) 네 값 중 하나를 대표로 취함
- focusable area: https://html.spec.whatwg.org/multipage/interaction.html#dom-anchor
- focus navigation: https://www.w3.org/TR/WICD/#focus-navigation

History In WICG
사실, 이 spatial navigation 이슈는 케케묵은 오래된 히스토리를 가지고 있었다.
가령 스마트폰 이전의 모바일 브라우저에서 이를 지원하기 위해서 방향키를 통해 navigation하는 것을 여러 곳에서 개발하는데
너무 이슈가 많고 어려움이 많아서 심지어는 방향키로 이동하다가 없으면 포인터가 나타나서 방향키가 포인터 제어로 쓰이고 그랬음
이는 TV에 한정된 기능이 아니라 다른 많은 분야에서 활용될 수 있다. (과거 모바일, 미래 IVI)
가령, 자동차에서 터치 behavior는 화면을 보면서 해야 하기에 위험하다. 자동차 핸들에 부착된 swing handle 또는 기어변속기 아래 조그셔틀 등으로 운전 중에 시선 변동 없이 조작하는 상황이 가장 효과적인 방법이고, 제어 시 음성 피드백을 통해 가능. 물론 AI 비서와의 커뮤니케이션이 가장 편하지만 그것만으로 모든 것을 할 수는 없다.

CSS WG에 이야기 할 때 어필할 내용
이는 모바일과 PC에서는 잘 와닿지 않을 수 있다. 하지만 TV나 IVI에서는 중요한 기능이다.
음성 기반, 터치 기반과는 거리가 있는, 어떻게 보면 구닥다리일 수 있으나, 미래에도 중요하게 활용될 기능이다.
이에 웹에서 다양한 기기를 서포트 하고자 하는 가치를 수호하기 위해서는 이를 존중해 주었으면 좋겠다.


9월 8일 첫 proposal draft 작성 완료 및 내부 검토
9월 15일 최종 draft 완성 및 WICG 업로드

■ WICG repository 내 Read.me 내용
description
css wg
chromium
...


■ description 내용
1. What is Spatial Navigation
2. Why is it important? (A11y)
3. Why we should support spatial navigation
4. How is it progress until now
사실, 이 spatial navigation 이슈는 케케묵은 오래된 히스토리를 가지고 있었다.
가령 스마트폰 이전의 모바일 브라우저에서 이를 지원하기 위해서 방향키를 통해 navigation하는 것을 여러 곳에서 개발하는데
너무 이슈가 많고 어려움이 많아서 심지어는 방향키로 이동하다가 없으면 포인터가 나타나서 방향키가 포인터 제어로 쓰이고 그랬음
5. current status
6. problem definition
7. how to solve it
8. in progress of CSS



1. Spatial Navigation Roadmap
  - 

1. heuristic spatial navigation 개선안 정리
  - CSSUI4 nav-* properties 관련 구글 코멘트 중 하나가 heuristic spatial navigation의 미흡한 완성도
  - 실제 샘플 앱을 통해 조작해보면 여러 문제점들이 드러남 (unreachability, distance calculation, aligning with scrolling)
  - 문제점을 보완한 heuristic algorithm 명세화 작업 진행 및 공개 (처음은 rough하게 진행하고 추후 확장)
  - 보완사항 구현 진행하고 bug patch 또는 intent to implement 등의 방식으로 upstream에 반영
  - spotlight 관점에서 heuristic algorithm에서 지원하면 좋은 사항들 검토 필요
    (e.g. accelerated key down, getLastFocusedElement, container focus)
  - 이를 위해서는 spotlight 코드 구조 파악 및 이해가 필요할 수도 있음

2. CSSUI4 nav-* properties 이슈 생성 및 해결방안 도출
  - level4로 옮겨왔으나, Chromium, CSSWG 등에서 잘 통과가 되지 못함
  - 히스토리 파악 및 


3. 



zero-copy texture upload 구현 현황, 크로미움이 GL 커맨드를 GPI로 보내는 것 관련 담당 조직?



■ 8월 16일(수) 오후 3시 회의 agenda
1. spotlight 내 spatial navigation 기능을 JS library에서 Native feature로 전환하려면?
- Heuristic Spatial Navigation Algorithm 표준화 및 오픈소스 JS 기반 Spatial Navigation 구현 현황 및 Chrome Spatial Navigation 구현 현황을 토대로 향후 계획 논의
- 정리된 Spatial Navigation 기본 알고리즘 명세 검토 및 보완 방안 논의
- 왜 크롬은 플래그로 Spatial Navigation을 두었을까? 웹 앱에서 선택할 수 있도록, 또는 설정에서 set하게 하지 않았을까?
- meta 태그를 통해 이를 enable 할 수 있는 방안 검토 (아니면 그냥 브라우저 자체에서 선택하게 두어야 할지?)
- 큰 로드맵 관점에서 구현 우리가 진행 가능할지? 얼마나 복잡도가 클지? 핵심 코어 알고리즘과 응용 API/Event 등을 정의하기
- 이를 토대로 표준화 방안 검토 및 향후 대응 방안 수립
- 삼성 등 이와 관련이 있는 곳이 어디가 있을지? 아군 끌어들이기 (삼성, IVI 업체, ...)
- 표준화 및 구현을 위해 외부 리소스를 끌어들이는 방안 검토 (구글에서 자발적으로? 삼성? 일본 가전 업체? 파나소닉 등. 이갈리아?)


■ 알고리즘
- basic algorithm(네 방향 각각 가장 가까운 요소 찾기, 장애물 있을 때 처리 등 예외상황 처리)
- cycle, last-focus(cache, hostory), dynamic contents insertion, grouping(parent)
- focus 이벤트, focus 가상 클래스 활용하는지?
- 필요한 이벤트? 필요한 JS API?
- 탭키와 방향키가 동시에 입력될 때 동작을 고려해야함

■ Spatial Navigation 주요 이슈
1. 포커스 이동 경로를 결정하는 알고리즘 보편성 문제
  - 간단한 알고리즘 수준으로는 보편성을 가지면서 잘 지원할 수 있을 것 같음
  - 주요 개념으로는 basic algorithm, last-focus, avoid inactivated element, exceptional cases, dynamic contents, ...
  - 하지만 완벽히 TV에서 원하는 UX를 지원하지는 못할테고, 이에 간단한 웹엔진 지원에 이를 수정하기 위한 API 제공 필요 (JS API, CSS, Event)

2. 컨테이너 개념 적용 방안
  - 포커스가 컨테이너에 부여되면, 해당 포커스를 그 안으로 전파하는 방식 (직접 Enact 개발시 일일이 spotlight 속성을 넣어 주어야 할지?)
  - 현재는 spotlight: 'container'를 명시해서 컨테이너를 정의하고, 그 안에 child에는 'spotlight: true'를 명시해서 구분함
  - 예제: http://enyojs.com/sampler/latest/spotlight/#ContainerSample

3. 포인터/키 입력모드 제공 방법
  - 현재 웹은 포인터 모드와 키입력 모드를 따로 구분하여 처리하는 경우는 없음 (모바일, PC 모두)
  - TV는 Remote Control의 특성상 한큐에 두 가지 모두를 지원하고 있음

4. 입력장치 또는 디바이스 타입에 따른 키입력(arrows) default behavior 달리 하는 옵션 검토
  - <meta> 태그 활용 또는 브라우저 실행 커맨드의 flag 옵션으로 명시 또는 디바이스 타입(e.g.MQ)에 따라 자동 적용(개발자 도구 모바일) 등
  - <meta> 태그 활용 예시: <meta name="device" content="type=tv, input=remote-controller">
  - 그런데 위의 approach 보다는 특정 컨테이너 안에다가 spatial navigation이 된다고 명시하는 방향이 더 나을 것 같기도 함
  - body에 걸면 모든 컨텐츠 간에 이동 가능한 구조이고 그 안에 또 nested된 컨테이너에도 명시 가능 (기본 동작은 차후 문제)
  - 아니면 브라우저 빌드 시 옵션으로 구분해 주어야 할 문제일지?


■ Article 구성 내용
- 리모컨에 AI가 급속도로 활용되고 있다. 하지만 검색 결과 내에서 5-way를 사용하는 후속 스텝을 고려해 보면 아직 5-way의 가치는 크다.
- 차량, TV 등 다양한 Industry에서 이에 대한 수요가 있다!!
- 다음 링크의 서론을 가져다 쓰자! (https://aerolab.co/blog/web-accessibility)
- 과거에는 ActiveX, Flash, ASP, jQuery로 가득 차 있었다. 애플릿. php, 등 추가


■ 크롬 spatial navigation 동작방식 (w/ --enable-spatial-navigation)
- tabindex+input요소에 한해 방향키로 포커스 이동 가능 (기존과 동일)
- 단, 차이는 --enable-spatial-navigation 모드인 경우에만 group focusing이 잡힘 (비교적 상위 레벨의 group에서만 동작하는 것 같음)
- 그리고 모든 상황에서 focus moving behavior를 수행하는 것이 아닌 특정 상황에서는 스크롤을 발생시키기도 함 (그 차이 구분 필요)
- 그리고 방향키를 눌렀을 때 해당 방향으로 scrollable 한 상황이면서 focusable한 요소가 없으면 스크롤 동작을 수행하다가,
  focusable한 요소가 화면에 나타나면 그 때서야 focus가 이동함 (즉, 방향키의 default behavior가 scroll과 focus move 두 가지인 셈)
- CSS WG, Spotlight에서 확인한 바 있는 이슈인데, focus ring(focus를 받았을 때 이를 표기하기 위한 테두리 borderline) 문제가 크롬에서도 있음 (e.g. image)
- 이에 네이버 메인 페이지의 메인 광고에 포커스가 가면 별도의 툴팁을 통해 Enter키를 누르면 해당 광고 페이지에 들어간다고 표기함 (관련하여 CSS 표준화 필요)
- 포커스 관련 그룹 개념은 크롬에 반영되어 있지 않은 것 같음 (e.g. yahoo.com에서 중앙 메인 기사의 social 페이지 진입 아이콘 내에 4개를 돌지 못함)
- Reachability는 보장되지 않는 것이 확인됨 (e.g. zdnet.co.kr에서 우측 중단에 칼럼 내 각 기사들을 방향키로 접근할 수 없음)


■ Sequential focus navigation starting point
https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation-starting-point
https://www.chromestatus.com/features/5671747802103808

■ The definition of spatial navigation
the ability to navigate between focusable elements, such as hyperlinks                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          